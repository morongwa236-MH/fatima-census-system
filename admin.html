<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <script src="script.js"></script>
  <style>
    body { font-family: Arial; margin: 20px; }
    input { padding: 6px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { margin: 2px; padding: 4px 8px; }
  </style>
</head>
<body>
  <script>
  const ADMIN_PASSWORD = "Fatima2025"; // change this to your own secret
  let entered = prompt("Enter Admin Password:");

  if (entered !== ADMIN_PASSWORD) {
    document.body.innerHTML = "<h2 style='color:red;'>Access Denied</h2>";
    throw new Error("Unauthorized access");
  }
</script>
  
  <h1>Admin Dashboard</h1>

  <input type="text" id="searchBox" placeholder="Search by name, block, ID...">
  <button onclick="loadRecords()">Search</button>

  <h2>Households</h2>
  <table id="householdTable"></table>

  <h2>Members</h2>
  <table id="memberTable"></table>

  <h2>Children</h2>
  <table id="childTable"></table>

  <script>
    let records = {};

    async function loadRecords() {
      const searchTerm = document.getElementById("searchBox").value.toLowerCase();
      records = await getAllRecords();

      renderTable("householdTable", records.households, ["id","blockName","address","mainContact"], searchTerm, "household");
      renderTable("memberTable", records.members, ["id","householdId","fullName","dob","occupation"], searchTerm, "member");
      renderTable("childTable", records.children, ["id","householdId","firstName","lastName","dob","age"], searchTerm, "child");
    }

    function renderTable(tableId, data, fields, searchTerm, type) {
      let table = document.getElementById(tableId);
      let html = "<tr>" + fields.map(f => `<th>${f}</th>`).join("") + "<th>Actions</th></tr>";

      data.filter(row => 
        !searchTerm || JSON.stringify(row).toLowerCase().includes(searchTerm)
      ).forEach(row => {
        html += "<tr>";
        fields.forEach(f => {
          html += `<td contenteditable="true" data-id="${row.id}" data-field="${f}" data-type="${type}">${row[f] || ""}</td>`;
        });
        html += `<td>
          <button onclick="updateRecord('${type}','${row.id}')">üíæ Save</button>
          <button onclick="deleteRecord('${type}','${row.id}')">üóëÔ∏è Delete</button>
        </td>`;
        html += "</tr>";
      });

      table.innerHTML = html;
    }

    async function updateRecord(type, id) {
      let cells = document.querySelectorAll(`td[data-id='${id}'][data-type='${type}']`);
      let updated = {};
      cells.forEach(c => { updated[c.dataset.field] = c.innerText; });

      let result = await editRecord(type, id, updated);
      alert(result.message);
      loadRecords();
    }

    async function deleteRecord(type, id) {
      if (!confirm("Are you sure you want to delete this record?")) return;
      let result = await removeRecord(type, id);
      alert(result.message);
      loadRecords();
    }

    loadRecords(); // auto load on page open
  </script>
</body>
</html>
